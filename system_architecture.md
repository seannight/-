# 泰迪杯智能客服系统 - 系统架构文档

## 系统概述

泰迪杯智能客服系统是一个基于FastAPI的轻量级Web应用，用于提供竞赛信息查询服务。系统采用模块化设计，包括PDF数据处理、问答引擎、API服务和用户界面四个主要组件。

## 系统架构图

```
┌────────────────────────────────────────────────────────────┐
│                      用户界面 (Frontend)                    │
│                                                            │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐   │
│  │  问答界面     │  │  表格浏览     │  │  系统监控     │   │
│  │  Dashboard    │  │  Tables       │  │  Monitoring   │   │
│  └───────┬───────┘  └───────┬───────┘  └───────┬───────┘   │
└──────────┼───────────────────┼───────────────────┼──────────┘
           │                   │                   │
           ▼                   ▼                   ▼
┌────────────────────────────────────────────────────────────┐
│                      API 服务 (Backend)                     │
│                                                            │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐   │
│  │  问答API      │  │  表格API      │  │  监控API      │   │
│  │  /api/ask     │  │  /api/tables  │  │  /api/health  │   │
│  └───────┬───────┘  └───────┬───────┘  └───────┬───────┘   │
└──────────┼───────────────────┼───────────────────┼──────────┘
           │                   │                   │
           ▼                   ▼                   ▼
┌────────────────────────────────────────────────────────────┐
│                      核心组件 (Core)                        │
│                                                            │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐   │
│  │  问答引擎     │  │  表格提取器   │  │  性能监控     │   │
│  │  QA Engine    │  │  PDF Parser   │  │  Monitoring   │   │
│  └───────┬───────┘  └───────┬───────┘  └───────────────┘   │
│          │                  │                              │
│          └──────────┬───────┘                              │
│                     ▼                                      │
│          ┌───────────────────┐                             │
│          │  数据存储/缓存    │                             │
│          │  Data Storage     │                             │
│          └───────────────────┘                             │
└────────────────────────────────────────────────────────────┘
```

## 核心组件说明

### 1. API服务 (Backend)

API服务建立在FastAPI框架之上，提供RESTful接口供前端或其他系统调用。

**主要组件**:
- **app/main.py**: 应用入口点，配置中间件和路由
- **app/routers/**: 路由模块，处理不同类型的请求
- **app/api/**: API实现，连接前端请求和核心组件

**设计特点**:
- 采用异步处理提高并发性能
- 使用中间件进行请求跟踪和错误处理
- 实现API缓存机制减少重复计算

### 2. 问答引擎 (QA Engine)

问答引擎负责理解用户问题并生成答案，采用混合架构结合规则引擎和TF-IDF算法。

**主要组件**:
- **app/qa/engine.py**: 主引擎类，协调各组件
- **app/qa/rules.py**: 规则匹配引擎
- **app/qa/retriever.py**: 文本检索模块

**技术亮点**:
- 结合TF-IDF和规则引擎的混合架构
- 支持上下文感知的多轮对话
- 轻量级设计，无需复杂深度学习模型

### 3. 表格提取器 (PDF Parser)

表格提取器负责从PDF文档中提取结构化数据，是系统的核心创新点之一。

**主要组件**:
- **app/data_processing/extract_tables.py**: 表格提取核心
- **app/data_processing/extract_text.py**: 文本提取模块

**技术亮点**:
- 使用pdfplumber精准识别表格结构
- 实现多级表头合并和跨页表格识别
- 支持Excel导出和结构化数据格式化

### 4. 性能监控 (Monitoring)

性能监控模块提供系统运行状态和性能指标，支持问题诊断和性能优化。

**主要组件**:
- **app/core/simple_monitor.py**: 简化版监控工具
- **app/utils/performance.py**: 性能优化工具

**设计特点**:
- 轻量级设计，最小化性能开销
- 提供实时健康检查和性能指标
- 支持资源使用统计和优化建议

### 5. 快速启动机制 (Fast Starter)

系统实现了创新的快速启动机制，在后台加载组件的同时提供即时响应。

**主要组件**:
- **app/core/fast_starter.py**: 后台加载管理
- **app/core/component_loader.py**: 组件加载器

**技术亮点**:
- 实现了组件的异步延迟加载
- 提供轻量级响应在完整组件加载前响应请求
- 优化用户体验，避免长时间等待

## 数据流

1. **用户查询流程**:
   - 用户在界面输入问题
   - 前端发送请求到 `/api/ask` 端点
   - 问答引擎处理请求并生成答案
   - 答案返回给前端并显示给用户

2. **表格检索流程**:
   - 用户请求表格数据
   - 前端发送请求到 `/api/tables` 端点
   - 表格提取器检索缓存数据或重新处理PDF
   - 结构化表格数据返回给前端并展示

## 性能优化设计

为满足低延迟和高可用的需求，系统实现了多项性能优化措施：

1. **组件懒加载**：系统启动时仅加载必要组件，其他组件在后台异步加载
2. **资源缓存**：常用查询结果、PDF处理结果等数据使用内存缓存
3. **响应压缩**：大型响应数据自动压缩，减少网络传输时间
4. **批量处理**：表格提取和数据处理使用批量操作提高吞吐量
5. **智能资源分配**：根据系统资源自动调整工作进程数量

## 扩展性设计

系统设计考虑了未来扩展的需求，主要体现在：

1. **模块化组件**：各功能组件松耦合，易于替换或升级
2. **标准API接口**：提供标准化接口，便于集成第三方组件
3. **可配置性**：关键参数通过配置文件和环境变量控制，无需代码修改
4. **文档完善**：详细的API文档和代码注释便于开发者理解和扩展

## 部署架构

系统设计为轻量级部署，无需复杂的服务器配置：

1. **单机部署**：适合演示和开发环境，所有组件在单一进程中运行
2. **优化部署**：根据硬件资源智能调整工作进程和缓存大小
3. **启动脚本**：提供简单的一键启动脚本，自动配置环境

## 总结

泰迪杯智能客服系统采用现代化、轻量级的设计理念，通过模块化组件和异步处理提供高性能的问答和数据服务。系统特别注重用户体验，实现了快速启动和低延迟响应，同时保持代码简洁和易于维护。 