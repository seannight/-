# 泰迪杯智能客服系统 - 网络连接指南

本文档提供了有关系统网络连接、离线模式和问题诊断的详细指南。

## 目录

1. [网络连接管理](#网络连接管理)
2. [离线模式功能](#离线模式功能)
3. [连接问题诊断](#连接问题诊断)
4. [常见问题解答](#常见问题解答)
5. [高级配置](#高级配置)

## 网络连接管理

系统设计了完善的网络连接管理机制，能够自动检测网络状态变化并做出相应调整：

### 自动检测和恢复
- 系统会定期检查网络连接状态，检测到断网时自动切换到离线模式
- 当网络恢复时，系统尝试重新连接到服务器并创建新会话
- 连接状态通过UI指示器实时展示当前状态

### 连接状态指示
界面右上角的连接状态指示器显示三种状态：
- 🟢 已连接：系统处于在线状态，可正常访问所有功能
- 🟠 连接中：系统正在尝试连接服务器
- 🔴 已断开：系统处于离线模式，仅提供基本功能

## 离线模式功能

当系统无法连接到服务器时，会自动切换到离线模式。离线模式下：

### 可用功能
- 基础问答功能：系统能够回答常见问题
- 离线会话：创建临时会话以保持对话连续性
- 热门问题推荐：提供常见问题建议

### 离线模式限制
- 无法使用知识图谱查询
- 无法处理复杂或专业问题
- 无法上传或处理PDF文件
- 无法访问实时数据或统计信息

## 连接问题诊断

当遇到连接问题时，系统提供了强大的诊断工具来帮助解决问题：

### 启动诊断工具
有三种方式启动诊断工具：
1. 点击出错时显示的"诊断问题"按钮
2. 在连接设置对话框中点击"运行诊断"
3. 通过开发者控制台调用`ConnectionDiagnosticTool.showDiagnosticModal()`

### 诊断流程
诊断工具会执行以下检查：
1. 网络环境检测：检查基本网络连接、VPN使用情况和网络延迟
2. API连接测试：尝试多个可能的API URL连接
3. 会话创建测试：确认可以成功创建用户会话

### 问题修复
诊断完成后，工具会提供针对性的解决方案：
- API URL修复：如果找到有效的API URL，可一键应用
- 离线模式切换：当无法连接时，可快速启用离线模式
- VPN和代理建议：针对VPN导致的问题提供建议

## 常见问题解答

### Q: 为什么我的问题没有得到回答？
**A:** 可能是连接问题导致的。检查右上角的连接状态指示器，如果显示红色断开图标，表示系统处于离线模式。点击出现的"诊断问题"按钮运行诊断工具。

### Q: 如何手动进入离线模式？
**A:** 点击连接设置按钮，在弹出的设置对话框中启用离线模式。或者运行诊断工具，选择"启用离线模式"解决方案。

### Q: 系统显示"API连接失败"是什么原因？
**A:** 可能的原因包括：
- 服务器未运行或维护中
- 网络连接问题（防火墙、VPN限制）
- API基础URL配置错误

运行诊断工具可以帮助确定具体原因。

### Q: 我刚才还能正常使用，突然就不能了？
**A:** 可能是网络状态发生变化或服务器暂时不可用。系统会自动切换到离线模式继续提供基本服务。当网络恢复时，系统会尝试自动重连。

## 高级配置

### API配置选项
系统支持通过localStorage进行高级配置：
- `api_base_url`: 设置API服务器基础URL
- `api_timeout`: 设置API请求超时时间（毫秒）
- `offline_mode`: 手动控制离线模式状态
- `network_debug`: 启用网络调试日志
- `api_debug`: 启用API调试日志

### VPN和代理环境
如果您在使用VPN或代理环境，可能需要：
1. 确保VPN允许本地网络请求通过
2. 在连接设置中配置正确的API URL
3. 增加API超时时间以适应网络延迟

### 自动诊断和修复
系统会定期检查连接状态，并在检测到问题时尝试自动修复：
- 每30秒检查一次API健康状态
- 网络恢复后自动尝试重新连接
- 多次失败后进入离线模式以确保系统可用性

---

如有更多问题，请联系系统管理员或参考[系统架构文档](./architecture.md)。 